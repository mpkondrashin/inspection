name: Inspection Windows Build
on: [push]
permissions:
  contents: write
jobs:
    build:
      runs-on: windows-latest
      steps:

        - uses: actions/checkout@v4

        - name: Set up Go
          uses: actions/setup-go@v3

        - name: Test 0
          run: go env GOPATH

        - name: Test 1
          run: echo $GOPATH

        - name: Test 3
          run: echo "ABC $(go env GOPATH) DEF"

        - name: setup env
          run: |
            echo "::set-env name=GOPATH::$(go env GOPATH)"
            echo "::add-path::$(go env GOPATH)/bin"
          env:
            ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'

        - name: Install fyne
          run: go install fyne.io/fyne/v2/cmd/fyne@latest
        
#        - name: Package
 #         run: `(go env GOPATH)\\bin\\fyne" package --os windows --executable ginspection.exe --name GInspection  --appID in.kondrash --appVersion "${{ github.ref_name }}".substring(1)  --icon ./bin/icon.png --release`
        - name: Build GInspection for Windows
          run: go build -ldflags "-H windowsgui" ./cmd/ginspection

        - name: Package
          run: fyne package --os windows --executable ginspection.exe --name GInspection --appID in.kondrash --appVersion ${{ github.ref_name }}.[1:] --icon ./bin/icon.png --release

        - name: Build Inspection for Windows
          run: go build ./cmd/inspection
    
        - name: Pack for Windows
          if: startsWith(github.ref, 'refs/tags/')
          run: Compress-Archive -Path bin/opengl32.dll, inspection.exe, ginspection.exe, README.md, config_example.yaml -Destination inspection_win64_${{ github.ref_name }}.zip
    
        - name: Release
          uses: softprops/action-gh-release@v1
#         if: startsWith(github.ref, 'refs/tags/')
          with:
            files: |
              inspection_win64_${{ github.ref_name }}.zip
      
      